insall -g tunnelmole
tmole 8000

# Create
sudo nano /etc/systemd/system/mybackend.app.gunicorn.socket
sudo nano /etc/systemd/system/mybackend.app.gunicorn.service

# Start
sudo systemctl start mybackend.app.gunicorn.socket
sudo systemctl start mybackend.app.gunicorn.service

# Enable
sudo systemctl enable mybackend.app.gunicorn.socket
sudo systemctl enable mybackend.app.gunicorn.service

# Status
sudo systemctl status mybackend.app.gunicorn.socket
sudo systemctl status mybackend.app.gunicorn.service


# Restart
sudo systemctl daemon-reload
sudo systemctl restart mybackend.app.gunicorn


# create nginx
sudo nano /etc/nginx/sites-available/mybackend.app


# Enable nginx
sudo ln -s /etc/nginx/sites-available/mybackend.app /etc/nginx/sites-enabled/mybackend.app

# chk nginx
sudo nginx -t

# restart nginx
sudo service nginx restart




celery -A tnt_backend worker --loglevel=info --pool=solo



# 1. Start & enable the REAL service
sudo systemctl start redis-server
sudo systemctl enable redis-server

# 2. Verify it's running
sudo systemctl status redis-server

# celery.service
sudo nano /etc/systemd/system/celery.service

# celerybeat.service (optional)
sudo nano /etc/systemd/system/celerybeat.service




sudo systemctl daemon-reload
sudo systemctl enable celery celerybeat
sudo systemctl start celery celerybeat

# Check status
sudo systemctl status celery
sudo systemctl status celerybeat



git fetch --all
git reset --hard origin/main









#####################################################33
#!/bin/bash
set -e

echo "Deployment started ..."

# echo "Backing up DB..."
# cp db.sqlite3 /tmp/db.sqlite3.bak || true

echo "Backing up settings.py..."
cp core/settings.py ~/settings-backup.py || true

echo "Cleaning working directory..."
git reset --hard
git clean -fd

echo "Pulling latest changes..."
git pull origin main

# echo "Restoring DB..."
# mv /tmp/db.sqlite3.bak db.sqlite3 || true

echo "Restoring settings.py..."
cp ~/settings-backup.py core/settings.py || true

source venv/bin/activate
echo "Virtual env 'venv' Activated !"

echo "Clearing Cache..."
find . -name "*.pyc" -delete
python manage.py clear_cache || true

echo "Installing Dependencies..."
pip install -r requirements.txt --no-input

echo "Serving Static Files..."
python manage.py collectstatic --noinput

echo "Running Database migration..."
python manage.py makemigrations
python manage.py 

deactivate
echo "Virtual env 'venv' Deactivated !"

echo "copying media..."
cp -r media /var/www/core/

echo "Reloading App..."
ps aux |grep gunicorn |grep core | awk '{ print $2 }' |xargs kill -HUP || true

echo "Restarting daphene server"
sudo systemctl restart daphne

echo "Deployment Finished!"
